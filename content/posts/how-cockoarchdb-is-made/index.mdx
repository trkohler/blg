---
title: "–ö–∞–∫ —Å–¥–µ–ª–∞–Ω–∞ CockroachDB?"
date: 2021-01-16
description: –í —ç—Ç–æ–º –ø–æ—Å—Ç–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ —Ç–æ–º –∫–∞–∫ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥—Ä–∞—Ñ, –≤ —á–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –≥—Ä–∞—Ñ–æ–≤—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏, –∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å —è–∑—ã–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–æ–≤—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö.
tags:
  - –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–æ–µ
  - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
slug: how-cockroachdb-is-made
---

–ù–µ–¥–∞–≤–Ω–æ –Ω–∞—Ç–∫–Ω—É–ª—Å—è –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ CockroachDB –∏ –Ω–µ –ø–æ–Ω—è–ª —é–º–æ—Ä–∞, —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Å –Ω–µ–π–º–∏–Ω–≥–æ–º. –ü—Ä–∏ —á–µ–º —Ç—É—Ç —Ç–∞—Ä–∞–∫–∞–Ω—ã? –ù–µ—É–∂–µ–ª–∏ —É —Ç–µ—Ö, –∫—Ç–æ –Ω–∞–∑—ã–≤–∞–ª —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–æ–¥–æ–º –∏–∑ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö –æ–±—â–µ–∂–∏—Ç–∏–π? –Ø –ª–∏—á–Ω–æ –¥–æ —Å–∏—Ö –ø–æ—Ä –ø–æ–º–Ω—é, –∫–∞–∫ –ø—Ä–æ—Å–Ω—É–ª—Å—è –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö —Ä—ã–∂–∏—Ö —É—Å–∞—Ç—ã—Ö —Ä–µ–±—è—Ç –ø–æ–ª–∑ –ø–æ –º–æ–µ–º—É –ª–∏—Ü—É.

üêú üêù üêú üêù

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –Ω–∞–º –ø–æ–Ω—è—Ç—å –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ CockroachDB

### –ö–ª–∞—Å—Ç–µ—Ä

–° —ç—Ç–∏–º –ø–æ–Ω—è—Ç–∏–µ–º –≤—ã, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –∑–Ω–∞–∫–æ–º—ã, –µ—Å–ª–∏ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∫–ª–∞—Å—Ç–µ—Ä ‚Äî —ç—Ç–æ –≤–∞—à–∞ CockroachDB. –ö–ª–∞—Å—Ç–µ—Ä —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–æ–¥ ‚Äî –º–∞—à–∏–Ω-—É—á–∞—Å—Ç–Ω–∏—Ü.

### –†–µ–π–Ω–¥–∂

CockroachDB —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ) –≤ –æ–≥—Ä–æ–º–Ω–æ–π –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞–ø–µ (—Å –ø–∞—Ä–∞–º–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ). –ö–ª—é—á–∏ –ø–æ–¥–µ–ª–µ–Ω—ã –Ω–∞ —Ä–µ–π–Ω–¥–∂–∏ —Ç–∞–∫, —á—Ç–æ –∫–∞–∂–¥—ã–π –∫–ª—é—á –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω –≤ –∫–∞–∫–æ–º-—Ç–æ –æ–¥–Ω–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ä–µ–π–Ω–¥–∂–µ.

–ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ä–µ–π–Ω–¥–∂ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç 512 MiB, –æ–Ω –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –¥–≤–∞ —Ä–µ–π–Ω–¥–∂–∞.

### –†–µ–ø–ª–∏–∫–∞

CockroachDB –∫–æ–ø–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —Ä–µ–π–Ω–¥–∂ (3 —Ä–∞–∑–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—É—é –∫–æ–ø–∏—é –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥–µ.

### –ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å

–î–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–π–Ω–¥–∂–∞ –µ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–º —Ä–µ–π–Ω–¥–∂–∞. –≠—Ç–∞ —Ä–µ–ø–ª–∏–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–µ–∫–≤–µ—Å—Ç—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é —ç—Ç–æ–≥–æ —Ä–µ–π–Ω–¥–∂–∞.

```
–ö–ª–∏–µ–Ω—Ç: –ú–æ–∂–Ω–æ –º–Ω–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ x?
–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å: –≥—É–ª—è–π –ª–µ—Å–æ–º, —Å—É–¥–∞—Ä—å, —É –Ω–∞—Å –ø–µ—Ä–µ—Ä—ã–≤ –Ω–∞ –æ–±–µ–¥.
```

### –õ–∏–¥–µ—Ä

–î–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø–∏—Å—å—é –≤ –∫–∞–∂–¥—ã–π —Ä–µ–π–Ω–¥–∂ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏–¥–µ—Ä, —Å–æ–≥–ª–∞—Å–Ω–æ [–†–∞—Ñ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—É](https://trkohler.com/distributed-system-consensus-algorithm-raft). –≠—Ç–∏–º –ª–∏–¥–µ—Ä–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–¥–Ω–∞ –∏–∑ —Ä–µ–ø–ª–∏–∫ –∏ –æ–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–µ–∫–≤–µ—Å—Ç—ã –Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö. –†–µ–ø–ª–∏–∫–∞-–ª–∏–¥–µ—Ä –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞ —Ñ–æ—Ä—É–º (–∫–≤–æ—Ä—É–º) –Ω–æ–¥ –Ω–µ –æ–¥–æ–±—Ä–∏—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é. –û–±—ã—á–Ω–æ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å –∏ –ª–∏–¥–µ—Ä ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ —Ä–µ–ø–ª–∏–∫–∞.

### –õ–æ–≥

–†–∞—Ñ—Ç –ª–æ–≥. –û–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ –≤–º–µ—Å—Ç–µ —Å –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–æ–π –∏ —è–≤–ª—è–µ—Ç—Å—è single source of truth –¥–ª—è —Ä–µ–π–Ω–¥–∂–∞. –õ–æ–≥ —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –†–∞—Ñ—Ç–∞ –∏ –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—Å–µ –º–∞—à–∏–Ω—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏–º–µ–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π state (—Å–æ—Å—Ç–æ—è–Ω–∏–µ).

## –°–ª–æ–∏ CockroachDB

### SQL

–≠—Ç–æ—Ç —Å–ª–æ–π –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ SQL API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –° –ø–æ–º–æ—â—å—é –Ω–µ–≥–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–≤—ã—á–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º. –ó–∞–¥–∞—á–∞ —ç—Ç–æ–≥–æ —Å–ª–æ—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ SQL statements –≤ –Ω–∞–±–æ—Ä key-value –ø–∞—Ä, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö. –≠—Ç–∏–º–∏ key-value –ø–∞—Ä–∞–º–∏ –ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–ª–æ–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–ü–æ—Å–ª–µ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è SQL statements –≤ –Ω–∞–±–æ—Ä key-value –ø–∞—Ä, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–≤–æ–π transactional —Å–ª–æ–π.

### Transactional

–≠—Ç–æ—Ç —Å–ª–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–µ–Ω –∑–∞ —Ç–æ, —á—Ç–æ–±—ã –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—ã–ª–∏ ACID (Atomicity, Consistency, Isolation, Durability) –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–ß—Ç–æ–±—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ CockroachDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–º–∏—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è \*–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã **(Parallel commits)\***.

–≠—Ç–æ–π —Å–ª–æ–π –ø–æ–ª—É—á–∞–µ—Ç KV –ø–∞—Ä—ã —Å–æ —Å–ª–æ—è –≤—ã—à–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏—Ö KV –ø–∞—Ä –≤ Distribution —Å–ª–æ–π.

### Distribution

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤ –ª—é–±–æ–π –Ω–æ–¥–µ –∫–ª–∞—Å—Ç–µ—Ä–∞, CockroachDB —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–≥—Ä–æ–º–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞–ø–µ —Å KV –ø–∞—Ä–∞–º–∏. –ö–ª—é—á –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏ –∏—Ö –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ. –í—Å–µ –∫–ª—é—á–∏ –ø–æ–¥–µ–ª–µ–Ω—ã –Ω–∞ —Ä–µ–π–Ω–¥–∂–∏.

–î–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Ç–æ–∫–æ–ª gRPC. –ï–≥–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —ç—Ç–æ–º —Å–ª–æ–µ. Distribution —Å–ª–æ–π ‚Äî —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π –æ–±—â–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –Ω–æ–¥–∞–º–∏.

### Replication

Replication —Å–ª–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–µ–Ω –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ. –¢—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∏ —Ç—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è [–†–∞—Ñ—Ç–∞](https://trkohler.com/distributed-system-consensus-algorithm-raft) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

CockroachDB —Ç—Ä–µ–±—É–µ—Ç—Å—è 3 –Ω–æ–¥—ã –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å high availability. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ 3 ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä—É–º.

### Storage

–ö–∞–∂–¥–∞—è –Ω–æ–¥–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ CockroachDB —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –æ–¥–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≥–¥–µ –≤–µ–¥–µ—Ç—Å—è —É—á–µ—Ç, –∫–æ–≥–¥–∞ –Ω–æ–¥–∞ –Ω–∞—á–∞–ª–∞ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É. –û—Ç—Ç—É–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å `cocroach` —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ —Ç–∞–∫ –∂–µ –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –Ω–∞ –¥–∏—Å–∫. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ key-value –ø–∞—Ä. –ü–æ –¥–µ—Ñ–æ–ª—Ç—É –¥–ª—è —ç—Ç–∏—Ö —Ü–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [Pebble](https://github.com/cockroachdb/pebble).

## –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è?

–ù–∞—á–Ω–µ–º —Å —Ç–æ–≥–æ, —á—Ç–æ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–π –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π `connection string` –∏ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –ø–æ—Å—Ç–≥—Ä–µ—Å–∞.

–ù–∞ –º–æ–π –≤–∑–≥–ª—è–¥, —ç—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ! CockroachDB –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å–æ–∑–¥–∞–µ—Ç –æ–ø—ã—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∞–º–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ–π —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

–†–µ–∫–≤–µ—Å—Ç –Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–∞–¥–∞–µ—Ç –Ω–∞ –≤–∞—à `load balancer` , –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞ –∫–∞–∫—É—é –Ω–æ–¥—É –µ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å. –¢–∞–∫ –∫–∞–∫ –≤—Å–µ –Ω–æ–¥—ã CockroachDB –∏–º–µ—é—Ç —Å–∏–º–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `load balancer` –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç (–≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö) –∫ –ª—é–±–æ–π –Ω–æ–¥–µ –∏ –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ª—é–±—ã–º –¥–∞–Ω–Ω—ã–º, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –ø—Ä–∏ —ç—Ç–æ–º _strong consistency_.

–ö–∞–∫ —Ç–æ–ª—å–∫–æ `load balancer` –æ–ø—Ä–µ–¥–µ–ª–∏–ª —Å–∞–º—É—é –ø–æ–¥—Ö–æ–¥—è—â—É—é –Ω–æ–¥—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –Ω–æ–¥–∞, –∫ –∫–æ—Ç–æ—Ä–æ–π –≤—ã –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å, –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ gateway (–≤—Ä–∞—Ç) –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞.

### –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è gateway –Ω–æ–¥—ã

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞—Å –∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∑–∞–ø–∏—Å—å, gateway –Ω–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –ª–∏ –≤ –ø–æ—Ä—è–¥–∫–µ —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø—Ä–∏—Å–ª–∞–ª–∏. –ï—Å–ª–∏ –≤—Å–µ –Ω–æ—Ä–º, –æ–Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ, —á—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `logical SQL plan`.

Logical SQL plan ‚Äî —ç—Ç–æ –ø–ª–∞–Ω –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ —Ç–æ, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–≤–µ—Ä—é, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –µ–π –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ üôÇ –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –ø–æ—Ç–æ–º –ø—Ä–∏–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å. –ú—ã –≤–µ–¥—å –ø–æ–º–Ω–∏–º, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —á—Ç–æ SQL ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫, –∏ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤—ã –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞–º –Ω–∞–¥–æ, –∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ —Å–∞–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –∂–µ–ª–∞–Ω–∏–π. –≠—Ç–æ –∏ –µ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `logical SQL plan`.

–¢–∞–∫ –∂–µ —ç—Ç–æ—Ç –ø–ª–∞–Ω —Ä–∞–∑–±–∏–≤–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, –∏ —Ç–∞–∫ –∂–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç SQL –º–µ—Ç–æ–¥—ã –≤ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–∞—Ä–∞–º–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, `INSERT` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `put()`

–ó–∞—Ç–µ–º gateway –Ω–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ –≤—Å–µ –Ω–æ–¥–µ, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ –∫–∞–∫ `leaseholder` —Ä–µ–π–Ω–¥–∂–∞.

### Leaseholder –Ω–æ–¥–∞

Leaseholder –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Ä–µ–∫–≤–µ—Å—Ç gateway –Ω–æ–¥—ã –æ–¥–Ω–∏–º –∏–∑ —Ç–∞–∫–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤.

- No Longer Leaseholder ‚Äî –µ—Å–ª–∏ –Ω–æ–¥–∞ –±–æ–ª—å—à–µ –Ω–µ leaseholder –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–π–Ω–¥–∂–∞, –Ω–æ –≤—Å–µ –µ—â–µ —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–ø–ª–∏–∫—É —Ä–µ–π–Ω–¥–∂–∞, –æ–Ω–∞ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–µ —Ä–µ–∫–≤–µ—Å—Ç–∞ –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∞–¥—Ä–µ—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –µ–π `leaseholder` —ç—Ç–æ–≥–æ —Ä–µ–π–Ω–¥–∂–∞.-
- No Longer Has/Never Had Range ‚Äî –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–æ–¥–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å–∏—Ç—å —Ä–µ–∫–≤–µ—Å—Ç –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –¢–æ–≥–¥–∞ `gateway` –Ω–æ–¥–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ `leaseholder` —Ä–µ–π–Ω–¥–∂–∞ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞.
- Success ‚Äî –≤—Å–µ –Ω–∞—à–ª–∏—Å—å –∏ –Ω–æ–¥–∞ `leaseholder` –ø—Ä–∏—Å—Ç—É–ø–∞–µ—Ç –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞.

`Leaseholder` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å, —É–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∫–≤–µ—Å—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `timestamp` ‚Äî –∏—Ö –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å serializability. –¢–∞–∫ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –¥–æ–≤–µ—Ä—è—Ç—å —Ç–æ–º—É, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≤–æ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è, —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ.

–ï—Å–ª–∏ –Ω–æ–¥–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∞ —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç `write intent` —Ç.–µ. –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å—å –∫–∞–∫–∏—Ö-—Ç–æ –¥–∞–Ω–Ω—ã—Ö, –æ–Ω–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–∏—Ç—å (`resolve`) –µ–≥–æ. –ï—Å–ª–∏ –∂–µ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, `leaseholder` –∏—â–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ä–µ–π–Ω–¥–∂–∞.

`Write intent` –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–≤–ª–µ–∫–∞—è –Ω–æ–¥—É-–ª–∏–¥–µ—Ä, —Å–æ–≥–ª–∞—Å–Ω–æ Raft –ø—Ä–æ—Ç–æ–∫–æ–ª—É.

### –õ–∏–¥–µ—Ä

`Leaseholder` —Ä–µ–π–Ω–¥–∂–∞ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ª–∏–¥–µ—Ä—É –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –≤–Ω–µ—Å—Ç–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –¥–∞–Ω–Ω—ã–µ. –°—Ä–∞–∑—É –∫–∞–∫ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏–µ –æ—Ç —Ñ–æ—Ä—É–º–∞, –æ–Ω–∞ –∑–∞–Ω–æ—Å–∏—Ç—Å—è –≤ Raft –ª–æ–≥ –ª–∏–¥–µ—Ä–∞ –∏ –ø–∏—à–µ—Ç—Å—è –≤ `storage`.

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–Ω–µ—Å–µ–Ω–∞ –≤ –ª–æ–≥, –æ–Ω–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è `commited`.

### –û–±—Ä–∞—Ç–Ω—ã–π –ø—É—Ç—å

–õ–æ–≥ —Ä–∞–∑–Ω–æ—Å–∏—Ç—Å—è –ø–æ –≤—Å–µ–º –Ω–æ–¥–∞–º, –≤–∫–ª—é—á–∞—è `leaseholder` . –ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —Å–≤–æ–µ–≥–æ –ª–æ–≥–∞, –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç gateway –Ω–æ–¥–µ "–¥–æ–±—Ä–æ". –í—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è gateway –Ω–æ–¥–∞ —Å–º–∏—Ä–µ–Ω–Ω–æ –∂–¥–∞–ª–∞, –ø–æ–∫–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–±—è—Ç–∞ –ø–æ—Ä–µ—à–∞—é—Ç —Å–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–æ–æ–±—â–∞—Ç –µ–π –æ —Ç–æ–º, –∫–∞–∫ —É –Ω–∏—Ö —Ç–∞–º –¥–µ–ª–∞.

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞, –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –∏ –≥–æ—Ç–æ–≤–∞ —Å–ª—É–∂–∏—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤—É –¥–∞–ª—å—à–µ.

## Graceful shutdown

–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–æ—á–∏—Ç–∞–ª–∏. –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —ç—Ç–æ –±—ã–ª –æ—á–µ–Ω—å —Å–∫—É—á–Ω—ã–π –ø–æ—Å—Ç, –∏ —è –≤–∞–º –æ—á–µ–Ω—å –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –∑–∞ –≤–∞—à—É –≤—ã–¥–µ—Ä–∂–∫—É.

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫–æ–π –º–∏–ª—ã–π ascii art! –≠—Ç–æ –∫–Ω–∏–∂–∫–∏.

–ê–≤—Ç–æ—Ä–∞ –Ω–µ –Ω–∞—à–µ–ª, –Ω–æ, –¥—É–º–∞—é, `hjw` —ç—Ç–æ –µ–≥–æ –ø–æ–¥–ø–∏—Å—å.

```
       .--.                   .---.
   .---|__|           .-.     |~~~|
.--|===|--|_          |_|     |~~~|--.
|  |===|  |'\     .---!~|  .--|   |--|
|%%|   |  |.'\    |===| |--|%%|   |  |
|%%|   |  |\.'\   |   | |__|  |   |  |
|  |   |  | \  \  |===| |==|  |   |  |
|  |   |__|  \.'\ |   |_|__|  |~~~|__|
|  |===|--|   \.'\|===|~|--|%%|~~~|--|
^--^---'--^    `-'`---^-^--^--^---'--' hjw
```

–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ø–æ—Å—Ç? ‚áí –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –Ω–∞ –º–æ—é –µ–º—ç–π–ª —Ä–∞—Å—Å—ã–ª–∫—É üïäÔ∏è

–ù–∞—à–ª–∏ –æ—à–∏–±–∫—É? ‚áí –û—Ç–∫—Ä–æ–π—Ç–µ issue [–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —ç—Ç–æ–≥–æ –±–ª–æ–≥–∞](https://github.com/trkohler/blg/issues) ‚ö†Ô∏è

–•–æ—Ç–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç—å? ‚áí –û—Ç–∫—Ä–æ–π—Ç–µ [pull request](https://github.com/trkohler/blg/pulls) ‚öôÔ∏è
